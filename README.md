# Chern predictor
This is a research code by Paul Baireuther. It will neither be monitored nor maintained. It is published here to assist researchers in reproducing the results in reference [[1]](#reference). The author hopes that it will also make further research in this direction easier.

## Table of contents
[Description](#description)</br>
[Installation and Execution](#installation-and-execution)</br>
[How to reproduce the research results in reference [1]](#how-to-reproduce-the-research-results-in-reference-1)</br>
[How to configure the computer experiments](#how-to-configure-the-computer-experiments)</br>
[Reference](#reference)</br>
[Dataset format](#dataset-format)</br>
[License information](#license-information)

## Description
The computer experiments are defined in `run_experiments.py`. The main steps are:

1) Generation of training data:
Datasets are generated by sampling from a distribution over Hamiltonians (as specified in reference [[1]](#reference)), analyzing the sampled Hamiltonians, and evaluating a selected subset on finite size lattices, including disorder. Each datapoint consists of a local density of state map ('input image'), the modulus of the corresponding Chern number ('class label'), as well as some meta-data (e.g. parameters, bandwidth, gap size).

2) Statistical analysis of datasets:
Some statistics of the datasets are calculated, e.g. the distribution over the number of states considered in the local density of state maps.

3) Training of neural networks:
A set of convolutional neural networks (CNNs) is trained on the training data to predict the modulus of the Chern number corresponding to a given local density of states map. More precisely, to predict a vector of weights, assigning a weight to each value in a set of predetermined candidate values for the Chern number modulus.

4) Evaluation of neural networks:
The trained neural networks are evaluated on the datasets, in particular on the test dataset, and the prediction vectors are collected. 

5) Calculation and evaluation of ensemble predictions:
The neural networks are grouped into ensembles -- more precisely, their collected prediction vectors are -- and subsequently ensemble predictions are determined. These ensemble predictions are then compared to the true labels resulting in accuracy over training epoch plots, confusion-matrices, and other performance plots.


## Installation and Execution
These instructions assume a Linux environment with Python 3.10, Python virtual environment, Git, and a LaTeX distribution installed. 

1) Clone the environment and go into the cloned directory
```
git clone https://github.com/baireuther/chern-predictor.git
cd chern-predictor
```
2) Create and activate a virtual environment. Subsequently, install the requirements from the `requirements.txt` file.
```
python3 -m venv venv/chern-predictor
source venv/chern-predictor/bin/activate
pip install -r requirements.txt 
```
3) Run the code
```
python3 run_experiments.py
```
The results will be stored in the `experiments` directory.

## How to reproduce the research results in reference [1]
1) As a prerequisite, you need to obtain the Shiba lattice model data which was used as test dataset in reference [[1]](#reference) and which is not part of this repository. It can be found at https://doi.org/10.5281/zenodo.7904700.

2) Perform step 1) in [Installation and Execution](#installation-and-execution).

3) Check out the branch `paper`.

4) Perform step 2) in [Installation and Execution](#installation-and-execution).

5) Create the directories `experiments/hopscale_1p0_hopcutoff_2_max_rel_pairing_1p0_mingap_0p146/datasets/` and `chern_predictor/figures/data/`.

6) Rename the Shiba dataset file from `Shiba_lattice_dataset.json` to `test.json` and copy it into `experiments/hopscale_1p0_hopcutoff_2_max_rel_pairing_1p0_mingap_0p146/datasets/`.

7) Copy the Shiba phase diagram data file `phase_diagram_gap_and_kf_in_0.1_12_e0_in_-0.8_0.8.txt` into `chern_predictor/figures/data/`.

8) Copy the Shiba Chern marker data files (`Chern_marker_scaling_*.txt`) into `chern_predictor/figures/data/`.

9) Disable the ONEDNN options by `export TF_ENABLE_ONEDNN_OPTS=0` (this might be unnecessary).

10) Perform step 3) in [Installation and Execution](#installation-and-execution).

The dependency versions that were used in the computer experiments are:

matplotlib==3.6.2</br>
numpy==1.23.4</br>
scipy==1.8.1</br>
tensorflow-cpu==2.9.2 (has security vulnerabilities, better don't use this version)

## How to configure the computer experiments
Most relevant parameters are defined in `default_parameters.py`. An explanation of the parameters is given in the [Dataset format](#dataset-format) section.

## Reference
[1] P. Baireuther, M. Płodzień, T. Ojanen, J. Tworzydło, T. Hyart, "Identifying Chern numbers of superconductors from local measurements", https://arxiv.org/abs/2112.06777.

## Dataset format
The datasets are stored as a list of datapoints in json format. Each datapoint is a dictionary.
### Complete set of entries
<ul>
<li> bulk_ham_params: (dictionary)</li>
    <ul>
    <li>hopping_cutoff: Maximal hopping distance to be considered (float)</li>
    <li>hopping_decay_scale: Scale on which hopping amplitude decays exponentially (float)</li>
    <li>max_relative_pairing_strength: Maximum ratio of pairing amplitude to hopping 
amplitude to be considered (float)</li>
    <li>min_absolute_gap: Smallest gap size to be considered in absolute units (float)</li>
    </ul>
<li>system_params: (dictionary)</li>
    <ul>
    <li>num_sites_x: Number of sites in x-direction (integer)</li>
    <li>num_sites_y: Number of sites in y-direction (integer)</li>
    <li>geometry: Description of the lattice shape in words (string)</li>
    </ul>
<li>dataset_params: (dictionary)</li>
    <ul>
    <li>chern_abs_vals: Set of Chern number moduli in the dataset (list of integers)</li>
    <li>ldos_window_as_fraction_of_gap: Size of the energy window to be considered in the LDOS 
calculation in units of the gap size (float)</li>
    <li>relative_disorder_strengths: Set of disorder amplitudes in units of the gap size (list 
of floats)</li>
    <li>smallest_ham_seed: Smallest seed, after that consecutively increasing seeds are used 
(integer)
</li>
    <li>num_hams_per_chern_number: Number of Hamiltonians to be generated per value of the 
modulus of the Chern number (integer)</li>
    <li>version: Version of the data generator (x.x.x)</li>
    <li>git_hash: The hash of the git-version of the code used to generate the data (hash 
number)</li>
    <li>average_gap: Gap-size averaged over all Hamiltonians of the clean and 
infinite systems (float)</li>
    <li>average_bandwidth: Bandwidth averaged over all Hamiltonians of the clean and 
infinite systems (float)</li>
    </ul>
<li>data_generation_params: (dictionary)</li>
    <ul>
    <li>chunk_size Chunk size used in parallel generation of Hamiltonians (integer)</li>
    </ul>
<li>ham_seed: Seed used in generation of bulk Hamiltonian (integer)</li>
<li>relative_pairing_strength: Strength of the pairing relative to the hopping amplitudes 
(float)</li>
<li>absolute_gap: Size of the bulk gap in absolute unites (float)</li>
<li>relative_gap: Size of the bulk gap in units of the bandwidth (float)</li>
<li>bandwidth: Bandwidth in absolute units (float)</li>
<li>chern_number: Chern number of bulk Hamiltonian (integer)</li>
<li>chern_number_absolute_value: Modulus of the Chern number (integer)</li>
<li>disorder_seed: Seed used in generation of (disordered) system realization (integer)</li>
<li>relative_disorder_strength: Disorder strength in units of the average band gap in the 
dataset (float)</li>
<li>eigenvalues_in_ldos: Eigenvalues of states that form the LDOS (list of floats)</li>
<li>num_states_in_ldos: Number of states that form the LDOS (integer)</li>
<li>local_density_of_states: Local density of states (list of floats) with the following format

     # The order of sites in terms of (x, y) in this list is
     # ( 0, 0), ( 0, 1), ..., ( 0, 23), 
     # ( 1, 0), ( 1, 1), ..., ( 1, 23),
     #   ...
     # (23, 0), (23, 1), ..., (23, 23)
</li>
</ul>

### Minimal set of entries
<ul>
<li>system_params: (dictionary)</li>
    <ul>
    <li>num_sites_x: Number of sites in x-direction (integer)</li>
    <li>num_sites_y: Number of sites in y-direction (integer)</li>
    </ul>
<li>relative_gap: Size of the bulk gap in units of the bandwidth (float)</li>
<li>chern_number_absolute_value: Modulus of the Chern number (integer)</li>
<li>relative_disorder_strength: Disorder strength in units of the average band gap in the 
dataset (float)</li>
<li>num_states_in_ldos: Number of states that form the LDOS (integer)</li>
<li>local_density_of_states: Local density of states (list of floats)</li>
</ul>

## License information
Copyright (c) 2020-2023, Paul Baireuther</br>
</br>
For the avoidance of doubt: Paul Baireuther is publishing this research code as a private activity.

This program is free software: you can redistribute it and/or modify it under the terms of the GNU Affero General Public License as published by the Free Software Foundation, version 3.

This program is distributed in the hope that it will be useful, but WITHOUT ANY WARRANTY; without even the implied warranty of MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE. See the GNU Affero General Public License for more details.

You should have received a copy of the GNU Affero General Public License along with this program. If not, see <https://www.gnu.org/licenses/>.
